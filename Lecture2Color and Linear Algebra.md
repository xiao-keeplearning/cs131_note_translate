# Lecture2:Color and Linear Algebra

## 1 色彩物理学

### 1.1 什么是颜色？

颜色是环境中物理光与我们的视觉系统之间相互作用的结果。颜色是当我们观察物体和灯光时，我们的视觉体验的心理特性，而不是这些物体或灯光的物理特性。

### 1.2 颜色和光

白光由可见光谱的全部波长中几乎相等的能量组成。

### 1.3 电磁频谱

光由不同波长的波组成。光的可见光谱波长范围从400nm到700nm，人类对波长在这个范围的光最敏感。人类只看到可见光，因为太阳能比其他颜色发出更多的黄光，并且它的温度也是如此。

### 1.4 可见光

普朗克黑体辐射定律根据表面温度估算恒星发射的电磁辐射波长。例如，由于太阳表面温度约为5800K，太阳发出的光的峰值位于可见区域。

### 1.5 光的物理学

任何光源都可以通过其光谱（即每个时间单位，在每个波长400-700nm处发射的能量）来表示。表面具有反射光谱：反射光聚焦在可见光谱的某一区域。例如，香蕉主要反射黄色光，而西红柿主要反射红光。

### 1.6 光与物体表面的相互作用

反射颜色是光源光谱与表面反射率相互作用的结果。通常，定义和单位为“每单位波长”。

光谱的定义是什么？

## 2 人与色彩

如前一节所述，颜色不只是光的物理属性 - 而是光与人类视觉系统之间的相互作用产生颜色现象。

### 2.1 视杆细胞和视锥细胞(Rods and Cones)

当我们观察一个场景时，光首先通过瞳孔进入我们的眼睛，然后到达视网膜。其中主要由两种类型的光敏细胞组成：视杆细胞和视锥细胞，是由在显微镜下的外观来命名的。视杆细胞（Rods）的数量更多，并且灵敏度高，使其成为在弱光条件下检测物体的理想选择。然而，它们不编码任何颜色信息。另一方面，视锥细胞(Cones)数量较少且灵敏度较低，但它们对于在高光条件下区分物体是有用的。它们还允许我们通过下面讨论的机制来感知颜色。

### 2.2 视锥细胞和颜色

视杆细胞和视锥细胞之间的关键区别在于后者有三种不同的类型，每种类型都有对应不同波长的响应曲线。每条响应曲线峰值都在特定的波长上（即440,530和560nm），与蓝色，绿色和红色的波长相对应。然而，视锥细胞和视杆细胞都起到__滤波器__的作用，其输出可以解释为每个响应曲线乘以光谱，在所有波长上积分。虽然3个数字编码的信息对于大多数任务是足够的，但是在视网膜上从光谱到电脉冲的压缩过程会丢失一些信息。这意味着一些光谱会被错误地认为是相同的 - 这种光谱被称为__metamers（同色异谱）__。

### 2.3 色彩搭配

由于我们对设计能够为观众提供一致的视觉体验的系统有兴趣，因此了解可以组合的最小颜色以创造任何可感知颜色的体验是有帮助的。Wandell的视觉基础实验表明，大多数人能够通过调整三种不同颜色的实验灯来重建给定测试光的颜色。此外，实验表明，对于相同的测试光，大多数人选择相似比重的三原色，色盲例外。最后，这个实验验证了颜色的三色理论 。

## 3 色彩空间(可以参考的[文章](https://zhuanlan.zhihu.com/p/24214731))

### 3.1 定义

色彩空间，或者说色彩模型，是一种抽象的数学模型，它将颜色范围描述为数字元组，通常为3或4个值或颜色分量（例如RGB）。

### 3.2 线性色彩空间

由三原色的选择来定义，颜色的坐标由用于匹配它的三原色的权重给出

- RGB Space
  - 原色是单色光（对于显示器，它们对应于三种类型的磷）
  - 某些波长的光需要减法匹配

![](F:\浙大研究生\cs131\notes\cs131_notes-master\lecture02\rgb1.png)

**图2：RBG原色的表示和相应的匹配函数。色匹配函数是匹配在横轴上显示的波长所对应的测试颜色所需的原色配比。可以看到有些波长上，曲线在负数区。**

- CIE XYZ Color Space
  - 原色是虚构的，但匹配函数在任何地方都大于0 
  - Y参数对应于颜色的亮度
  - 可以通过线性变换转换到RGB空间，符合Grassmann定律

  ![](F:\浙大研究生\cs131\notes\cs131_notes-master\lecture02\xyz1.png)

**图3： 左图表示CIE XYZ 色彩空间，右图表示 CIE XYZ 色彩空间的色匹配函数。**

![](F:\浙大研究生\cs131\notes\cs131_notes-master\lecture02\color1.png)

**图1：两种颜色光的不同比例组合可以产生在色彩空间里，两点之间的直线上的所有颜色。3种颜色的不同比例组合可以产生由三个点包围而成的三角形上的所有颜色。**

### 3.3 非线性色彩空间：HSV

- 旨在反映更传统、直观的混色模型（例如油漆混合）
- 基于人类视觉中颜色的组织和概念化
- 3个参数：色调(Hue)，饱和度(Saturation)和强度(Value)

![](F:\浙大研究生\cs131\notes\cs131_notes-master\lecture02\hsv1.png)

## 4 白平衡

### 4.1 定义

白平衡是将传感器接收的图像正确调整为渲染中性色（白色，灰色等）的处理。这个调整是由数码相机自动执行的（针对不同光线的自定义设置），胶片相机提供多种滤镜和胶片类型以适应不同的拍摄条件。

**Note:灰色就是R=G=B>0的情形**

### 4.2 白平衡的重要性

由于一些原因，未经调整的图像具有不自然的颜色“投射”，使得白平衡非常重要：

1. 相机或胶卷中的传感器与我们眼中的传感器不同
2. 不同的显示媒介以不同方式呈现图像
3. 拍摄图像时的观看条件通常与查看图像时的条件不同

### 4.3 Von Kries 色适应理论

Von Kries的白平衡方法是将每个通道缩放一个“增益因子”，以匹配灰色中性物体的外观。

在实践中，实现这一目标的最佳方法是**Gray Card** 方法：拍一张带有中性颜色（灰色或白色）物体(例图里是卡片)的照片并确定该物体在每个通道上的值。如果我们发现该中性物体RGB值分别为$$r_w,g_w,b_w$$,我们就分别缩放图像的3个通道,缩放因子分别为$$\frac{1}{r_w},\frac{1}{g_w},\frac{1}{b_w}$$。

![1549984769247](F:\浙大研究生\cs131\notes\cs131_notes-master\lecture02\black card)

### 4.4 其它方法

除了Gray Cards方法外,，我们需要猜测哪些像素对应于白色物体。尝试实现这一目标有几种方法，包括统计和机器学习模型（超出了本课程的范围）。

**Gray World Assumption**  在这个模型下，我们假定图片中3个通道的像素平均值($$r_{ave},g_{ave},b_{ave}$$)为灰色,然后用缩放因子$$\frac{1}{r_{ave}},\frac{1}{g_{ave}},\frac{1}{b_{ave}}$$缩小像素值。

**Brightest Pixel Assumption** 这适用于非饱和图像，并假设图像具有光源(通常是白色)的颜色。因此，它通过加权每个通道与该通道的最大像素值的倒数来校正白平衡。

**Gamut Mapping**  图像的色域是图像中显示的所有像素颜色的集合（在数学术语中，这是“凸包(convex hull)”和所有可能颜色组合的子集）。然后，我们可以对图像作变换，将图像的色域映射到白光下的“标准”图像的色域。

### 4.5 计算机视觉中的色彩的其它用途

色彩在皮肤检测，裸体检测和图像分割以及其它应用中起着重要作用。

## 5 线性代数基础：向量和矩阵

### 5.1 向量

略

### 5.2 矩阵

### 5.3 基本矩阵运算

Norm  $||x||_2=\sqrt{\sum^n_{i=1}x_i^2}$

更正式的说，norm是满足以下特性的函数$f:R^n\rightarrow R$:

1. 非负性：对所有的$x \in R^n,f(x) \geq0​$
2. 正定：当且仅当$x=0$时，$f(x)=0$
3. Homogeneity(同质性)：对所有的$x \in R^n,t\in R,f(tx)=|t|f(x)​$
4. 三角不等式：对所有的$x,y \in R^n,f(x+y)\leq f(x)+f(y)$

One Norm ${x}_{1} = \sum\limits_{i=1}\limits^{n}{\lvert x_{i} \rvert}​$
Infinity Norm ${x}_{\inf} = {max}_{i} \lvert x_{i}\rvert​$
General P Norm ${x}_{p} = \bigg(\sum\limits_{i=1}\limits^{n}{x_{i}^{p}}\bigg)^{1/p}​$
Matrix Norm ${A}_{F} = \sqrt[]{\sum\limits_{i=1}\limits^{m}\sum\limits_{j=1}\limits^{n}{A_{ij}^2}} = \sqrt[]{tr(A^TA)}​$

**Dot Product**

**矩阵乘法（Multiplication）**

**转置**

**Determinant（秩）**

**Trace(迹)**

**特殊矩阵**： 单位矩阵，对角矩阵，对称矩阵，反对称矩阵

